#!/usr/bin/env node
/**
Copyright: 2021 Contrast Security, Inc
  Contact: support@contrastsecurity.com
  License: Commercial

  NOTICE: This Software and the patented inventions embodied within may only be
  used as part of Contrast Securityâ€™s commercial offerings. Even though it is
  made available through public repositories, use of this Software is subject to
  the applicable End User Licensing Agreement found at
  https://www.contrastsecurity.com/enduser-terms-0317a or as otherwise agreed
  between Contrast Security and the End User. The Software may not be reverse
  engineered, modified, repackaged, sold, redistributed or otherwise used in a
  way not consistent with the End User License Agreement.
*/

const startTime = process.hrtime();

const loader = require('./agent-loader');

async function exec() {
  const { script, enabled } = await loader.init(process.argv, true);

  // only bootstrap if agent is enabled
  if (enabled) {
    await loader.bootstrap(process.argv);
  }

  loader.logTime(startTime, 'agent');

  const appStartTime = process.hrtime();
  await loader.run(process.argv[0], script);
  loader.logTime(startTime);
  loader.logTime(appStartTime, 'application');
  loader.logTime(startTime, 'agent & application');
}

exec();
